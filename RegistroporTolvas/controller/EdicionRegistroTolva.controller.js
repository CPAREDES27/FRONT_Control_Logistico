sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./utilities","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/core/BusyIndicator"],function(e,t,o,i,a,r){"use strict";return e.extend("com.tasa.tolvas.registrotolvas.controller.EdicionRegistroTolva",{handleRouteMatched:function(e){let t=this.getOwnerComponent().getModel("passModel").getProperty("/data");this.getView().setModel(new i(t),"EditRegistroTolvasModel")},_onButtonPress2:function(e){var t="";this.mDialogs=this.mDialogs||{};var o=this.mDialogs[t];if(!o){o=new(this.getView());this.mDialogs[t]=o;o.setRouter(this.oRouter)}var i=e.getSource().getBindingContext();o._oControl.setBindingContext(i);o.open()},onPressSave:function(e){let i=this.getView().getModel("EditRegistroTolvasModel");let a=i.getProperty("/CDEMB");let s=i.getProperty("/NRDES");let n=[{cmopt:`NRDES = '${s}'`,cmset:`CDEMB = '${a}'`,nmtab:"ZFLDES"}];o.updateFieldTableRFC(n).then(e=>{t.success("Se actualizaron los datos correctamente",{title:"Exito",onClose:function(){r.show(0);this.sendMailNotif()}.bind(this),styleClass:"",actions:sap.m.MessageBox.Action.OK,emphasizedAction:t.Action.OK,initialFocus:t.Action.OK,textDirection:sap.ui.core.TextDirection.Inherit})})},sendMailNotif:function(){let e=this.getView().getModel("EditRegistroTolvasModel");console.log(e);var t=e.getProperty("/CDPTA");var i=e.getProperty("/WERKS")+" ";var a=e.getProperty("/NRDES")+" ";var s=e.getProperty("/NMEMB")+" ";var n=e.getProperty("/MREMB")+" ";var l=e.getProperty("/CPPMS");var g=e.getProperty("/FIDES")+" ";var c=e.getProperty("/FFDES")+" ";var u="";if(l){if(!isNaN(l)){if(l>0){u=l+" "}else{u="0 "}}else{u="0 "}}else{u="0 "}var d=e.getProperty("/CNPDS");var v="";if(d){if(!isNaN(d)){if(d>0){v=d+" "}else{v="0 "}}else{v="0 "}}else{v="0 "}var h=[i,a,s,n,u,g,c,v];var p=[h.join("%")];o.enviarNotificacion(t,p).then(e=>{console.log("Email: ",e);r.hide()});this.oRouter.navTo("RouteMain")},onCancelEditRegTolvas:function(){this.oRouter.navTo("RouteMain")},onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getTarget("TargetEdicionRegistroTolva").attachDisplay(jQuery.proxy(this.handleRouteMatched,this));var e=this.getView();e.addEventDelegate({onBeforeShow:function(){if(sap.ui.Device.system.phone){var t=e.getContent()[0];if(t.getShowNavButton&&!t.getShowNavButton()){t.setShowNavButton(true);t.attachNavButtonPress(function(){this.oRouter.navTo("",{},true)}.bind(this))}}}.bind(this)})},onAbrirAyudaEmbarcacion:function(){this.getDialog().open()},onSelectEmba:function(e){var t=e.getSource().getBindingContext("CombosModel").getObject();if(t){var o=t.CDEMB;var i=t.NMEMB;var a=t.MREMB;var r=this.getView().getModel("EditRegistroTolvasModel");console.log(r);r.setProperty("/CDEMB",o);r.setProperty("/NMEMB",i);r.setProperty("/MREMB",a);this.getDialog().close()}},onSearchEmbarcacion:function(){r.show(0);var e=this.getOwnerComponent().getModel("CombosModel");var t=sap.ui.getCore().byId("idEmba").getValue();var i=sap.ui.getCore().byId("idNombEmba").getValue();var a=sap.ui.getCore().byId("idMatricula").getValue();var s=sap.ui.getCore().byId("idRucArmador").getValue();var n=sap.ui.getCore().byId("idDescArmador").getValue();var l=sap.ui.getCore().byId("indicadorPropiedad").getSelectedKey();var g=[];var c=[];let u=[];g.push({cantidad:"20",control:"COMBOBOX",key:"ESEMB",valueHigh:"",valueLow:"O"});if(t){g.push({cantidad:"20",control:"COMBOBOX",key:"CDEMB",valueHigh:"",valueLow:t})}if(i){g.push({cantidad:"20",control:"COMBOBOX",key:"NMEMB",valueHigh:"",valueLow:i})}if(a){g.push({cantidad:"20",control:"COMBOBOX",key:"MREMB",valueHigh:"",valueLow:a})}if(l){g.push({cantidad:"20",control:"COMBOBOX",key:"INPRP",valueHigh:"",valueLow:l})}if(s){c.push({cantidad:"20",control:"COMBOBOX",key:"STCD1",valueHigh:"",valueLow:s})}if(n){c.push({cantidad:"20",control:"COMBOBOX",key:"NAME1",valueHigh:"",valueLow:n})}var d={option:[],option2:[],options:g,options2:c,p_user:"BUSQEMB"};o.obtenerEmbarcaciones(d).then(t=>{console.log("Embarcaciones: ",t);e.setProperty("/Embarcaciones",t);r.hide()})},onCerrarEmba:function(){this.getDialog().close()},getDialog:function(){if(!this.oDialog){this.oDialog=sap.ui.xmlfragment("com.tasa.tolvas.registrotolvas.view.Embarcacion",this);this.getView().addDependent(this.oDialog)}return this.oDialog}})},true);