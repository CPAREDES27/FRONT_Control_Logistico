sap.ui.define(["./BaseController","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/core/util/ExportTypeCSV","sap/ui/core/util/Export","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,o,i,n,r,s){"use strict";const l="https://cf-nodejs-qas.cfapps.us10.hana.ondemand.com/api/";var c=new sap.m.BusyDialog;var d={fechaIni:"",fechaIni2:""};var u="";var p="";return e.extend("tasa.com.consultapreciospesca.controller.App",{onInit:function(){let e=new a({});var t=new sap.m.BusyDialog;this.setModel(e,"litoral");this.setModel(e,"precio");this.setModel(e,"castigo");this.setModel(e,"reporteCala");this.loadComboPrecio();this.listPlanta();this.loadIndicadorP();this.listaArmador()},buscarFecha:function(e){var t=new Date(e.mParameters.from);var a=new Date(e.mParameters.to);if(e.mParameters.from==null){t=""}if(e.mParameters.to==null){a=""}var o=e.mParameters.id;var i="";var n="";if(t){i=this.generateFecha(t)}if(a){n=this.generateFecha(a)}debugger;if(o==="application-consultapreciospesca-display-component---App--idFechaIniVigencia"){d={fechaIni:i,fechaIni2:n}}},generateFecha:function(e){var t=e.getDate();var a=e.getFullYear();var o=e.getMonth()+1;if(o<10){o=this.zeroFill(o,2)}if(t<10){t=this.zeroFill(t,2)}var i=a.toString()+o.toString()+t.toString();return i},listaArmador:function(){c.open();var e={codigo:"100"};fetch(`${l}General/Armador`,{method:"POST",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{var t=e.data;console.log(t);console.log(this.getView().getModel("Armador").setProperty("/listaArmador",t));c.close()}).catch(e=>console.log(e))},listPlanta:function(){c.open();var e={delimitador:"|",fields:[],no_data:"",option:[{wa:"INPRP = 'P'"},{wa:"AND ESREG = 'S'"}],options:[],order:"",p_user:"FGARCIA",rowcount:0,rowskips:0,tabla:"ZV_FLPL"};fetch(`${l}General/Read_Table`,{method:"POST",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{var t=e.data;console.log(this.getView().getModel("Planta").setProperty("/listaPlanta",t));c.close()}).catch(e=>console.log(e))},limpiarFiltros:function(){this.byId("idPlantaIni").setValue("");this.byId("idPlantaFin").setValue("");this.byId("idArmadorIni").setValue("");this.byId("idArmadorFin").setValue("");this.byId("idEmbarcacionIni").setValue("");this.byId("idEmbarcacionFin").setValue("");this.byId("idFechaIniVigencia").setValue("")},loadComboPrecio:function(){c.open();var e=null;var t=null;const a={dominios:[{domname:"ZESCSG",status:"A"},{domname:"ZESPRC",status:"A"}]};fetch(`${l}dominios/Listar`,{method:"POST",body:JSON.stringify(a)}).then(e=>e.json()).then(a=>{console.log(a);e=a.data.find(e=>e.dominio=="ZESPRC").data;t=a.data.find(e=>e.dominio=="ZESCSG").data;this.getModel("precio").setProperty("/ZDO_PRECIO",e);this.getModel("castigo").setProperty("/ZESPRC",t);c.close()}).catch(e=>console.log(e))},goBackMain:function(){this.getRouter().navTo("RouteApp");location.reload()},loadTablaPreciosAcopio:function(){c.open();let e=[];var t=this.byId("idPlantaIni").getValue();var a=this.byId("idPlantaFin").getValue();var o=this.byId("idArmadorIni").getValue();var i=this.byId("idArmadorFin").getValue();var n=this.byId("idEmbarcacionIni").getValue();var r=this.byId("idEmbarcacionFin").getValue();var s=this.byId("idEstado").getSelectedKey();var u=this.byId("idEstadoCastigo").getSelectedKey();if(t&&!a){e.push({cantidad:"10",control:"MULTIINPUT",key:"WERKS",valueHigh:t,valueLow:t})}if(!t&&a){e.push({cantidad:"10",control:"MULTIINPUT",key:"WERKS",valueHigh:a,valueLow:a})}if(t&&a){e.push({cantidad:"10",control:"MULTIINPUT",key:"WERKS",valueHigh:a,valueLow:t})}if(o&&!i){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMP",valueHigh:o,valueLow:o})}if(!o&&i){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMP",valueHigh:i,valueLow:i})}if(o&&i){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMP",valueHigh:i,valueLow:o})}if(n&&!r){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMB",valueHigh:n,valueLow:n})}if(!r&&r){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMB",valueHigh:r,valueLow:r})}if(n&&r){e.push({cantidad:"10",control:"MULTIINPUT",key:"CDEMB",valueHigh:r,valueLow:n})}if(d.fechaIni||d.fechaIni2){e.push({cantidad:"10",control:"MULTIINPUT",key:"FECCONMOV",valueHigh:d.fechaIni2,valueLow:d.fechaIni})}let p={option:[],options:e,p_user:"FGARCIA"};console.log(p);var m=-1;fetch(`${l}preciospesca/ConsultarProb`,{method:"POST",body:JSON.stringify(p)}).then(e=>e.json()).then(e=>{var t=e;console.log(t);this.getView().getModel("Acopio").setProperty("/listaPrecio",t.str_app);this.byId("title").setText("Lista de registros: "+t.str_app.length);if(t.str_app.length<=0){this.byId("title").setText("Lista de registros: No se encontraron resultados")}c.close()}).catch(e=>console.log(e))},zeroFill:function(e,t){t-=e.toString().length;if(t>0){return new Array(t+(/\./.test(e)?2:1)).join("0")+e}return e+""},buscarEmbarca:function(e){console.log(e);var t=e.mParameters.listItem.oBindingContexts.Embarcacion.sPath.split("/")[2];console.log(t);var a=this.getView().getModel("Embarcacion").oData.listaEmbarcacion[t].CDEMB;if(this.popEmb==="popEmb"){this.byId("idEmbarcacionIni").setValue(a)}else if(this.popEmb==="popEmb2"){this.byId("idEmbarcacionFin").setValue(a)}this._onCloseDialogEmbarcacion()},_onOpenDialogEmbarcacion:function(e){this.popEmb=e;this.getView().getModel("Embarcacion").setProperty("/listaEmbarcacion","");this._getDialogEmbarcacion().open()},_onCloseDialogEmbarcacion:function(){this._getDialogEmbarcacion().close()},_getDialogEmbarcacion:function(){if(!this._oDialogEmbarcacion){this._oDialogEmbarcacion=sap.ui.xmlfragment("tasa.com.consultapreciospesca.view.DlgEmbarcacion",this.getView().getController());this.getView().addDependent(this._oDialogEmbarcacion)}sap.ui.getCore().byId("idEmbarcacion").setValue("");sap.ui.getCore().byId("idEmbarcacionDesc").setValue("");sap.ui.getCore().byId("idMatricula").setValue("");sap.ui.getCore().byId("idRuc").setValue("");sap.ui.getCore().byId("idArmador").setValue("");return this._oDialogEmbarcacion},listaEmbarcacion:function(){c.open();console.log("BusquedaEmbarca");var e=sap.ui.getCore().byId("idEmbarcacion").getValue();var t=sap.ui.getCore().byId("idEmbarcacionDesc").getValue();var a=sap.ui.getCore().byId("idMatricula").getValue();var o=sap.ui.getCore().byId("idRuc").getValue();var i=sap.ui.getCore().byId("idArmador").getValue();var n=sap.ui.getCore().byId("idPropiedad").getSelectedKey();var r=[];var s=[];r.push({cantidad:"20",control:"COMBOBOX",key:"ESEMB",valueHigh:"",valueLow:"O"});if(e){r.push({cantidad:"20",control:"COMBOBOX",key:"CDEMB",valueHigh:"",valueLow:e})}if(t){r.push({cantidad:"20",control:"COMBOBOX",key:"NMEMB",valueHigh:"",valueLow:t})}if(a){r.push({cantidad:"20",control:"COMBOBOX",key:"MREMB",valueHigh:"",valueLow:a})}if(o){s.push({cantidad:"20",control:"COMBOBOX",key:"STCD1",valueHigh:"",valueLow:o})}if(i){s.push({cantidad:"20",control:"COMBOBOX",key:"NAME1",valueHigh:"",valueLow:i})}var d={option:[],option2:[],options:r,options2:s,p_user:"BUSQEMB"};console.log(d);fetch(`${l}embarcacion/ConsultarEmbarcacion/`,{method:"POST",body:JSON.stringify(d)}).then(e=>e.json()).then(e=>{console.log(e);var t=e.data;console.log(t);console.log(this.getView().getModel("Embarcacion").setProperty("/listaEmbarcacion",t));sap.ui.getCore().byId("titleEmbarca").setText("Lista de registros: "+t.length);if(t.length<=0){sap.ui.getCore().byId("titleEmbarca").setText("Lista de registros: No se encontraron resultados")}c.close()}).catch(e=>console.log(e))},loadIndicadorP:function(){c.open();var e=null;var t={dominios:[{domname:"ZINPRP",status:"A"}]};fetch(`${l}dominios/Listar/`,{method:"POST",body:JSON.stringify(t)}).then(e=>e.json()).then(t=>{console.log(t);e=t.data.find(e=>e.dominio=="ZINPRP").data;this.getModel("Propiedad").setProperty("/listaPropiedad",e);c.close()}).catch(e=>console.log(e))},_onOpenDialogArmador:function(e){this.popUp=e;this.getView().getModel("Armador").setProperty("/listaArmador","");this._getDialogArmador().open()},_onCloseDialogArmador:function(){this._getDialogArmador().close();sap.ui.getCore().byId("idRuc2").setValue("");sap.ui.getCore().byId("idDescripcion").setValue("");sap.ui.getCore().byId("idCuentaProveedor").setValue("");sap.ui.getCore().byId("idListaArmador").setText("Lista de registros:")},_getDialogArmador:function(){if(!this._oDialogArmador){this._oDialogArmador=sap.ui.xmlfragment("tasa.com.consultapreciospesca.view.DlgArmador",this.getView().getController());this.getView().addDependent(this._oDialogArmador);sap.ui.getCore().byId("idAciertosPop").setValue("200")}return this._oDialogArmador},buscar:function(e){console.log(e);var t=e.mParameters.listItem.oBindingContexts.Armador.sPath.split("/")[2];console.log(t);var a=this.getView().getModel("Armador").oData.listaArmador[t].LIFNR;if(this.popUp==="popOne"){this.byId("idArmadorIni").setValue(a)}else if(this.popUp==="popTwo"){this.byId("idArmadorFin").setValue(a)}this._onCloseDialogArmador()},onDataExport:function(){var e=new n({exportType:new i({separatorChar:";",charset:"utf-8"}),models:this.getView().getModel("Acopio"),rows:{path:""},rows:{path:"/listaPrecio"},columns:[{name:"Centro",template:{content:"{WERKS}"}},{name:"Matricula",template:{content:"{MREMB}"}},{name:"Embarcacion",template:{content:"{NMEMB}"}},{name:"Armador",template:{content:"{NAME1}"}},{name:"Fecha prod",template:{content:"{FECCONMOV}"}},{name:"Cant. descargada",template:{content:"{CNPDS}"}},{name:"Compra",template:{content:"{PRCOM}"}},{name:"Bonif",template:{content:"{BONIF}"}},{name:"Venta",template:{content:"{PRVEN}"}},{name:"Moneda",template:{content:"{DESC_WAERS}"}},{name:"Estado",template:{content:"{DESC_ESPRC}"}},{name:"% Prop",template:{content:"{PCSPP}"}},{name:"% Def",template:{content:"{PCCSG}"}},{name:"Estado",template:{content:"{DESC_ESCSG}"}},{name:"Obs. super.",template:{content:"{OBCDF}"}},{name:"Obs. ger.",template:{content:"{OBCPP}"}},{name:"Calidad",template:{content:"{CALIDAD}"}},{name:"% Juveniles",template:{content:"{JUVEN}"}},{name:"TVN",template:{content:"{TVN}"}},{name:"TDC",template:{content:"{TDC}"}},{name:"Obs. calidad",template:{content:"{OBCPP}"}},{name:"Orden compra",template:{content:"{EBELN}"}},{name:"Factura",template:{content:"{BELNR}"}},{name:"Doc. Fi",template:{content:"{DOCFI}"}},{name:"Doc. Anulación",template:{content:"{DOCFI2}"}}]});e.saveFile("Precios de Acopio").catch(function(e){MessageBox.error("Error when downloading data. ..."+e)}).then(function(){e.destroy()})},filterGlobally:function(e){var t=e.getParameter("query");this._oGlobalFilter=null;if(t){this._oGlobalFilter=new r([new r("DOCFI2",s.Contains,t),new r("DOCFI",s.Contains,t),new r("BELNR",s.Contains,t),new r("EBELN",s.Contains,t),new r("OBCPP",s.Contains,t),new r("OBCDF",s.Contains,t),new r("DESC_ESCSG",s.Contains,t),new r("DESC_ESPRC",s.Contains,t),new r("DESC_WAERS",s.Contains,t),new r("CALIDA",s.Contains,t),new r("FECCONMOV",s.Contains,t),new r("NAME1",s.Contains,t),new r("NMEMB",s.Contains,t),new r("MREMB",s.Contains,t),new r("WERKS",s.Contains,t)],false)}this._filter()},_filter:function(){var e=null;if(this._oGlobalFilter&&this._oPriceFilter){e=new r([this._oGlobalFilter,this._oPriceFilter],true)}else if(this._oGlobalFilter){e=this._oGlobalFilter}else if(this._oPriceFilter){e=this._oPriceFilter}this.byId("table").getBinding().filter(e,"Application")}})});